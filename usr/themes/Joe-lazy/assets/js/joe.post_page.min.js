function submit_baidu(e="推送中..."){$("#Joe_Baidu_Record").html(`<span style="color: #E6A23C">${e}</span>`),$.ajax({url:Joe.BASE_API,type:"POST",dataType:"json",data:{routeType:"baidu_push",domain:window.location.protocol+"//"+window.location.hostname,url:encodeURI(window.location.href)},success(e){e.data.error?$("#Joe_Baidu_Record").html('<span style="color: #F56C6C">推送失败，请检查！</span>'):$("#Joe_Baidu_Record").html('<span style="color: #67C23A">推送成功！</span>')},error(e){$("#Joe_Baidu_Record").html('<span style="color: #F56C6C">推送失败，请检查！</span>')}}),Joe.BAIDU_PUSH&&$.ajax({url:Joe.BASE_API,type:"POST",dataType:"json",data:{routeType:"bing_push",domain:window.location.protocol+"//"+window.location.hostname,url:encodeURI(window.location.href)}})}document.addEventListener("DOMContentLoaded",()=>{const e=e=>window.btoa(unescape(encodeURIComponent(e))),o=e=>decodeURIComponent(escape(window.atob(e))),t=$(".joe_detail").attr("data-cid");{const e=$(".article-poster-images"),o=$(".poster-download"),a=$(".poster-popover-mask"),r=async()=>{Qmsg.loading("正在生成海报，请稍候...");try{const r=await fetch(`/index.php/ArticlePoster/make?cid=${t}`),n=await r.json();if(Qmsg.closeAll(),200!==n.code)throw new Error(n.data||"操作失败，请重试。");e.attr("src",n.data),o.data("url",n.data),a.css("display","flex"),Qmsg.success("操作成功！")}catch(e){Qmsg.error(e.message)}},n=()=>{$("<a>",{href:o.data("url"),download:"海报"}).appendTo("body").click().remove()};$(".article-poster-button").on("click",r),o.on("click",n),a.on("click",function(){$(this).css("display","none")})}if($(".icon.ysnizs").click(function(){$(".reward-overlay").css("display","flex")}),$(".reward-overlay").click(function(){$(this).css("display","none")}),$.ajax({url:Joe.BASE_API,type:"POST",dataType:"json",data:{routeType:"baidu_record",site:window.location.href},success(e){if(!e.data){if(Joe.BAIDU_PUSH)return void $("#Joe_Baidu_Record").html('<a href="javascript:submit_baidu();" rel="noopener noreferrer nofollow" style="color: #F56C6C">检测失败，提交收录</a>');const e=`https://ziyuan.baidu.com/linksubmit/url?sitename=${encodeURI(window.location.href)}`;return void $("#Joe_Baidu_Record").html(`<a target="_blank" href="${e}" rel="noopener noreferrer nofollow" style="color: #F56C6C">检测失败，提交收录</a>`)}if("已收录"===e.data)return $("#Joe_Baidu_Record").css("color","#67C23A"),void $("#Joe_Baidu_Record").html("已收录");if("未收录"==e.data&&Joe.BAIDU_PUSH)return void submit_baidu("未收录，推送中...");if(Joe.BAIDU_PUSH)return void $("#Joe_Baidu_Record").html(`<a href="javascript:submit_baidu();" rel="noopener noreferrer nofollow" style="color: #F56C6C">${e.data}，提交收录</a>`);const o=`https://ziyuan.baidu.com/linksubmit/url?sitename=${encodeURI(window.location.href)}`;$("#Joe_Baidu_Record").html(`<a target="_blank" href="${o}" rel="noopener noreferrer nofollow" style="color: #F56C6C">${e.data}，提交收录</a>`)}}),"undefined"!=typeof Prism){for(var a=document.getElementsByTagName("pre"),r=0;r<a.length;r++)a[r].getElementsByTagName("code").length>0&&(a[r].className="line-numbers");Prism.highlightAll(!0,null)}document.addEventListener("copy",function(e){setTimeout(function(){!0!==window.code_copy&&!0!==window.post_copy&&(Qmsg.warning(`本文版权属于 ${Joe.TITLE} 转载请标明出处！`),window.post_copy=!0),window.code_copy=!1},100)}),$(".joe_detail__article img:not(img.owo_image)").each(function(){$(this).wrap($(`<span style="display: block;" data-fancybox="Joe" href="${$(this).attr("src")}"></span>`))}),$(".joe_detail__article a:not(.joe_detail__article-anote)").each(function(){$(this).attr({target:"_blank",rel:"noopener noreferrer nofollow"})});{let a=localStorage.getItem(e("views"))?JSON.parse(o(localStorage.getItem(e("views")))):[];const r=a.includes(t);r||$.ajax({url:Joe.BASE_API,type:"POST",dataType:"json",data:{routeType:"handle_views",cid:t},success(o){if(1!==o.code)return;$("#Joe_Article_Views").html(`${o.data.views} 阅读`),a.push(t);const r=e("views"),n=e(JSON.stringify(a));localStorage.setItem(r,n)}})}{const a=document.querySelector(".joe_detail__agree .icon"),r=document.querySelector(".joe_detail__agree .text");let n=JSON.parse(o(localStorage.getItem(e("agree")))||"[]"),i=!1;a.addEventListener("click",async()=>{if(i)return;i=!0;const o=n.includes(t),a=new URLSearchParams({routeType:"handle_agree",cid:t,type:o?"disagree":"agree"}),l=await fetch(Joe.BASE_API,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a});if(l.ok){const a=await l.json();if(1!==a.code)return;const i=n.indexOf(t);o&&-1!==i?n.splice(i,1):o||-1!==i||n.push(t),localStorage.setItem(e("agree"),e(JSON.stringify(n))),r.textContent=a.data.agree}i=!1})}{let e=!1;$(".joe_detail__article-protected").on("submit",function(o){o.preventDefault();const a=$(this).attr("action")+"&time="+ +new Date,r=$(this).find('input[type="password"]').val();if(""===r.trim())return Qmsg.info("请输入访问密码！");e||(e=!0,$.ajax({url:a,type:"POST",data:{cid:t,protectCID:t,protectPassword:r},dataType:"text",success(o){let t=[],a="";t=$(o).contents(),Array.from(t).forEach(e=>{"container"===e.parentNode.className&&(a=e)}),/Joe/.test(o)?location.reload():(Qmsg.warning(a.textContent.trim()||""),e=!1,$(".joe_comment__respond-form .foot .submit button").html("发表评论"))}}))})}if($(".joe_detail__article-video").length>0){const e=$(".joe_detail__article-video .play iframe").attr("data-player");$(".joe_detail__article-video .episodes .item").on("click",function(){$(this).addClass("active").siblings().removeClass("active");const o=$(this).attr("data-src");let t=$(this).attr("alt");$(".joe_detail__article-video .play iframe").attr({src:e+o+"&autoplay=1&screenshot=1&theme="+encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue("--theme").trim())}),t&&$(".joe_detail__article-video .play .title").html(t)}),$(".joe_detail__article-video .episodes .item").first().click()}$(".joe_detail__operate-share").length&&($(".joe_detail__operate-share > svg").on("click",e=>{e.stopPropagation(),$(".joe_detail__operate-share").toggleClass("active")}),$(document).on("click",()=>$(".joe_detail__operate-share").removeClass("active")))}),window.addEventListener("load",function(){{const e=new URLSearchParams(location.search).get("scroll");if(e){let o=null;if(o=$("#"+e).length>0?$("#"+e):$("."+e),o&&o.length>0){const e=o.offset().top-$(".joe_header").height()-15;window.scrollTo({top:e,behavior:"smooth"})}}}});